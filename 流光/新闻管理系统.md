## 毕设进展

已经确定使用服务端使用框架，并且使用springboot整合好mybatis，redis，swagger等框架。使用sa-toekn作为了安全框架开发出安全接口（登录 认证 加密） 用户管理（用户增删改查）新闻管理接口（新闻增删改查 ） 并且自己自定义redis序列化，整合框架完成了新闻文章的缓存。

## 开题答辩

### 系统主要有什么功能 大概模样

系统将采用b/s结构，分别有pc管理端和新闻前台。 管理员将通过pc管理端对前台进行管理运营。

管理端功能如下：

- 管理员登录
- 用户管理 （增删改查）
- 分类管理   (增删改查)
- 新闻管理   (增删改查)
- 用户兴趣管理 (增删改查)
- 角色管理   (分配 修改)
- 首页banner图管理 （设置首页轮播图）
- 等系统资料设置

前台功能如下：

- 用户登录 注册
- 用户进行新闻的发布 删除 修改 
- 根据关键字查找新闻并且分页
- 首页新闻推荐（根据兴趣爱好推荐）
- 用户自己的信息管理 （修改 ）
- 用户点赞他人文章  
- 用户关注他人
- 用户可与其他用户聊天  
- 等功能。 （优化）

## 目前进展 如第一条

## 遇到了什么问题 解决了吗

### 在做前后端分离的时候，发现自己的后端接口可以被其他第三方任意使用， 并且前端如何知道用户登录且有权访问登录后的页面

在网上查阅大量资料后，很多资料都是使用springsecurity 来做登录认证 确保接口在被访问时需要有效令牌才能被使用，后来翻阅gitee大量开源项目，决定使用国产安全框架sa-token，原因是入手快，适合我这样的对认证鉴权知识认识不是特别充分的开发者。 sa-token会在登录后生成一个token令牌，将token令牌存在session中，前端每次进入页面后，vue的路由守卫都会去会话中查找这个token并解析，如果有且正确则会放行使用接口。这样就解决了我的问题。

### 如何保障mysql 和redis的数据一致性？ 

在编写新闻接口的时候，想到了一个问题，如果文章字节比较多，那么会不会每次点击文章都去mysql中查找，这样会对数据库IO有很大的压力呢?然后就想到用redis ，在使用redis的时候，有这样一个问题，如何保障MySQl与redis的一致性？提出问题，我们在第一次读取新闻内容的时候，先去Redis中查找，如果未击中，那么去mysql中查找，如果找到了返回数据就得了，然后再把查出来的数据存到redis中，以用来第二次查找，就不用去mysql中查找了。那么问题来了，如果在第一次存到redis后，该用户或者其他用户修改了该文章内容，那么第二次用户会不会查找还事redis中的数据，而不是已经改变的数据，在这里我经查阅大量资料，对比各种结果，**决定在增加接口的时候先修改内容到mysql中，然后再删除redis中的缓存。这样的话不管第几次调用查询接口，redis中的缓存已经被删除了，不存在则不会不一致。**



### 如何将图片进行存储，是否存储在数据库中？

一开始是想存在数据库中，但觉得这样会影响IO效率，然后经查验资料，决定把图片存储在阿里云的OSS中，把图片地址存储在数据库中，这样无论项目在何生产环境中，都可以不影响图片的存储，而且对数据库也是十分友好的。



## 中期检查

目前后端接口已经编辑差不多完成，在进行前端页面的编写，在编写的过程中，可能会多一两个接口。

-config   WebMvcConfig 这里是为了前端能够访问后端而写的跨域配置

-constant 这里是定义的一些常数 为了代码的可读性  比如我在定义性别的时候数据库中存的是0 但是我这里可以定义 MAN=0；

-controller 控制层 这里写着全部的接口 

​	-AuthController 登陆认证的接口

​	-ColumnController 分栏管理的接口

​	-ContentController 新闻内容的接口

​	-MsmApiController 短信认证的接口 比如发短信 这种

​	-NewsController 这里是新闻管理接口

​	-OssController 这里是文件上传的接口 使用的阿里云oss

​	-RoleController 角色的接口 但是没有定义多少角色 系统只有admin和 user 两个权限

​	-SubscribeController 订阅关系的接口

​	-TagController 标签管理接口

​	-UserController 用户管理接口

​	-UtilsController 一些工具类的接口 比如ip查询 天气查询

-entity 所有的实体类

-exceptionhandler 这里自定义了一些异常处理  

-mapper mybatis的Sql代码

-mysql mybatisplus的一些配置 自动填充创建时间和修改时间 还有一分页配置

-redis 自定义redis的序列化 以及redis的一些增删查改

-result 统一返回结果

-security 使用sa-token 来搭建的认证鉴权配置 为了系统的登录鉴权功能

-service  这是业务逻辑层 所有的业务逻辑都在这里 

-swagger 后端的接口文档 为了能够测试代码

-utils 一些系统的工具类

​	-ConstantPropertiesUtils 阿里云文件上传的key配置

​	-JbcryptUtil 用户密码加密

​	-MsmConstantUtils 腾讯云短信的一些配置 key

​	-RandomUtil 生成随机数的工具类

-AdminApplication 系统的启动类

